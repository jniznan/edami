<!-- Generated by Cython 0.19.1 on Thu Nov  7 10:06:47 2013 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.19.1 on Thu Nov  7 10:06:47 2013
<p>Raw output: <a href="sgd.c">sgd.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: # cython: cdivision=True</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "edami/sgd.pyx":1
 * # cython: cdivision=True             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * # cython: boundscheck=False
 * # cython: wraparound=False
 */
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s____test__, ((PyObject *)__pyx_t_2)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # cython: boundscheck=False</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: # cython: wraparound=False</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: </pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line5")'> 5: import numpy as np</pre>
<pre id='line5' class='code' style='background-color: #FFFF8d'>
  /* "edami/sgd.pyx":5
 * # cython: wraparound=False
 * 
 * import numpy as np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * import sys
 * from time import time
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__np, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line6")'> 6: import sys</pre>
<pre id='line6' class='code' style='background-color: #FFFF8d'>
  /* "edami/sgd.pyx":6
 * 
 * import numpy as np
 * import sys             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * from time import time
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__sys), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__sys, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line7")'> 7: from time import time</pre>
<pre id='line7' class='code' style='background-color: #FFFF57'>
  /* "edami/sgd.pyx":7
 * import numpy as np
 * import sys
 * from time import time             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * cimport numpy as np
 */
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_n_s__time));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__time));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_n_s__time));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__time), ((PyObject *)__pyx_t_1), -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s__time);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__time, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: </pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: cimport numpy as np</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: cimport cython</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: </pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: ctypedef np.float64_t DOUBLE</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'>
/* "edami/sgd.pyx":12
 * cimport cython
 * 
 * ctypedef np.float64_t DOUBLE             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * ctypedef np.int32_t INTEGER
 * 
 */
typedef __pyx_t_5numpy_float64_t __pyx_t_5edami_3sgd_DOUBLE;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13: ctypedef np.int32_t INTEGER</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: </pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15: </pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line16")'> 16: def sgd(np.ndarray[DOUBLE, ndim=2, mode='c'] X,</pre>
<pre id='line16' class='code' style='background-color: #FFFF57'>
/* "edami/sgd.pyx":16
 * 
 * 
 * def sgd(np.ndarray[DOUBLE, ndim=2, mode='c'] X,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double alpha,
 *         Py_ssize_t concepts,
 */

static PyObject *__pyx_pf_5edami_3sgd_sgd(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_X, double __pyx_v_alpha, Py_ssize_t __pyx_v_concepts, Py_ssize_t __pyx_v_n_iters, PyArrayObject *__pyx_v_qmatrix, PyArrayObject *__pyx_v_skills, PyArrayObject *__pyx_v_b, Py_ssize_t __pyx_v_learn_b) {
  int __pyx_v_S;
  int __pyx_v_P;
  PyArrayObject *__pyx_v_pairs = 0;
  double __pyx_v_prediction;
  double __pyx_v_error;
  double __pyx_v_k;
  int __pyx_v_ele;
  int __pyx_v_s;
  int __pyx_v_p;
  CYTHON_UNUSED Py_ssize_t __pyx_v_epoch;
  Py_ssize_t __pyx_v_c;
  PyObject *__pyx_v_oldskill = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_X;
  __Pyx_Buffer __pyx_pybuffer_X;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_b;
  __Pyx_Buffer __pyx_pybuffer_b;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_pairs;
  __Pyx_Buffer __pyx_pybuffer_pairs;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_qmatrix;
  __Pyx_Buffer __pyx_pybuffer_qmatrix;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_skills;
  __Pyx_Buffer __pyx_pybuffer_skills;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("sgd", 0);
  __pyx_pybuffer_pairs.pybuffer.buf = NULL;
  __pyx_pybuffer_pairs.refcount = 0;
  __pyx_pybuffernd_pairs.data = NULL;
  __pyx_pybuffernd_pairs.rcbuffer = &__pyx_pybuffer_pairs;
  __pyx_pybuffer_X.pybuffer.buf = NULL;
  __pyx_pybuffer_X.refcount = 0;
  __pyx_pybuffernd_X.data = NULL;
  __pyx_pybuffernd_X.rcbuffer = &__pyx_pybuffer_X;
  __pyx_pybuffer_qmatrix.pybuffer.buf = NULL;
  __pyx_pybuffer_qmatrix.refcount = 0;
  __pyx_pybuffernd_qmatrix.data = NULL;
  __pyx_pybuffernd_qmatrix.rcbuffer = &__pyx_pybuffer_qmatrix;
  __pyx_pybuffer_skills.pybuffer.buf = NULL;
  __pyx_pybuffer_skills.refcount = 0;
  __pyx_pybuffernd_skills.data = NULL;
  __pyx_pybuffernd_skills.rcbuffer = &__pyx_pybuffer_skills;
  __pyx_pybuffer_b.pybuffer.buf = NULL;
  __pyx_pybuffer_b.refcount = 0;
  __pyx_pybuffernd_b.data = NULL;
  __pyx_pybuffernd_b.rcbuffer = &__pyx_pybuffer_b;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_X.rcbuffer->pybuffer, (PyObject*)__pyx_v_X, &__Pyx_TypeInfo_nn___pyx_t_5edami_3sgd_DOUBLE, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_X.diminfo[0].strides = __pyx_pybuffernd_X.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_X.diminfo[0].shape = __pyx_pybuffernd_X.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_X.diminfo[1].strides = __pyx_pybuffernd_X.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_X.diminfo[1].shape = __pyx_pybuffernd_X.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_qmatrix.rcbuffer->pybuffer, (PyObject*)__pyx_v_qmatrix, &__Pyx_TypeInfo_nn___pyx_t_5edami_3sgd_DOUBLE, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_qmatrix.diminfo[0].strides = __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_qmatrix.diminfo[0].shape = __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_qmatrix.diminfo[1].strides = __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_qmatrix.diminfo[1].shape = __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_skills.rcbuffer->pybuffer, (PyObject*)__pyx_v_skills, &__Pyx_TypeInfo_nn___pyx_t_5edami_3sgd_DOUBLE, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_skills.diminfo[0].strides = __pyx_pybuffernd_skills.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_skills.diminfo[0].shape = __pyx_pybuffernd_skills.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_skills.diminfo[1].strides = __pyx_pybuffernd_skills.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_skills.diminfo[1].shape = __pyx_pybuffernd_skills.rcbuffer->pybuffer.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_b.rcbuffer->pybuffer, (PyObject*)__pyx_v_b, &__Pyx_TypeInfo_nn___pyx_t_5edami_3sgd_DOUBLE, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_b.diminfo[0].strides = __pyx_pybuffernd_b.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_b.diminfo[0].shape = __pyx_pybuffernd_b.rcbuffer->pybuffer.shape[0];

  /* "edami/sgd.pyx":16
 * 
 * 
 * def sgd(np.ndarray[DOUBLE, ndim=2, mode='c'] X,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double alpha,
 *         Py_ssize_t concepts,
 */
  __pyx_k_tuple_14 = <span class='py_c_api'>PyTuple_Pack</span>(20, ((PyObject *)__pyx_n_s__X), ((PyObject *)__pyx_n_s__alpha), ((PyObject *)__pyx_n_s__concepts), ((PyObject *)__pyx_n_s__n_iters), ((PyObject *)__pyx_n_s__qmatrix), ((PyObject *)__pyx_n_s__skills), ((PyObject *)__pyx_n_s__b), ((PyObject *)__pyx_n_s__learn_b), ((PyObject *)__pyx_n_s__S), ((PyObject *)__pyx_n_s__P), ((PyObject *)__pyx_n_s__pairs), ((PyObject *)__pyx_n_s__prediction), ((PyObject *)__pyx_n_s__error), ((PyObject *)__pyx_n_s__k), ((PyObject *)__pyx_n_s__ele), ((PyObject *)__pyx_n_s__s), ((PyObject *)__pyx_n_s__p), ((PyObject *)__pyx_n_s__epoch), ((PyObject *)__pyx_n_s__c), ((PyObject *)__pyx_n_s__oldskill));<span class='error_goto'> if (unlikely(!__pyx_k_tuple_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_tuple_14);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_14));

  /* "edami/sgd.pyx":16
 * 
 * 
 * def sgd(np.ndarray[DOUBLE, ndim=2, mode='c'] X,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double alpha,
 *         Py_ssize_t concepts,
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_5edami_3sgd_1sgd, NULL, __pyx_n_s_17);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s__sgd, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17:         double alpha,</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18:         Py_ssize_t concepts,</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19:         Py_ssize_t n_iters,</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20:         np.ndarray[DOUBLE, ndim=2, mode='c'] qmatrix,</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21:         np.ndarray[DOUBLE, ndim=2, mode='c'] skills,</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22:         np.ndarray[DOUBLE, ndim=1, mode='c'] b,</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23:         Py_ssize_t learn_b):</pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: </pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25:     cdef int S = X.shape[0]</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":25
 *         Py_ssize_t learn_b):
 * 
 *     cdef int S = X.shape[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int P = X.shape[1]
 *     cdef np.ndarray[long, ndim=1, mode='c'] pairs
 */
  __pyx_v_S = (__pyx_v_X->dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26:     cdef int P = X.shape[1]</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":26
 * 
 *     cdef int S = X.shape[0]
 *     cdef int P = X.shape[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef np.ndarray[long, ndim=1, mode='c'] pairs
 *     cdef double prediction = 0.0
 */
  __pyx_v_P = (__pyx_v_X->dimensions[1]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27:     cdef np.ndarray[long, ndim=1, mode='c'] pairs</pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28:     cdef double prediction = 0.0</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":28
 *     cdef int P = X.shape[1]
 *     cdef np.ndarray[long, ndim=1, mode='c'] pairs
 *     cdef double prediction = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double error = 0.0
 *     cdef double k = 0.0
 */
  __pyx_v_prediction = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29:     cdef double error = 0.0</pre>
<pre id='line29' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":29
 *     cdef np.ndarray[long, ndim=1, mode='c'] pairs
 *     cdef double prediction = 0.0
 *     cdef double error = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef double k = 0.0
 *     cdef int ele = 0
 */
  __pyx_v_error = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30:     cdef double k = 0.0</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":30
 *     cdef double prediction = 0.0
 *     cdef double error = 0.0
 *     cdef double k = 0.0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int ele = 0
 *     cdef int s = 0
 */
  __pyx_v_k = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31:     cdef int ele = 0</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":31
 *     cdef double error = 0.0
 *     cdef double k = 0.0
 *     cdef int ele = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int s = 0
 *     cdef int p = 0
 */
  __pyx_v_ele = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32:     cdef int s = 0</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":32
 *     cdef double k = 0.0
 *     cdef int ele = 0
 *     cdef int s = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int p = 0
 * 
 */
  __pyx_v_s = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33:     cdef int p = 0</pre>
<pre id='line33' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":33
 *     cdef int ele = 0
 *     cdef int s = 0
 *     cdef int p = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     pairs = np.array([s + p*S for s in range(S) for p in range(P) if not np.isnan(X[s, p])])
 */
  __pyx_v_p = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: </pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1a' onclick='toggleDiv("line35")'> 35:     pairs = np.array([s + p*S for s in range(S) for p in range(P) if not np.isnan(X[s, p])])</pre>
<pre id='line35' class='code' style='background-color: #FFFF1a'>
  /* "edami/sgd.pyx":35
 *     cdef int p = 0
 * 
 *     pairs = np.array([s + p*S for s in range(S) for p in range(P) if not np.isnan(X[s, p])])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for epoch in range(n_iters):
 *         np.random.shuffle(pairs)
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = __pyx_v_S;
  for (__pyx_t_4 = 0; __pyx_t_4 <code><</code> __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_s = __pyx_t_4;
    __pyx_t_5 = __pyx_v_P;
    for (__pyx_t_6 = 0; __pyx_t_6 <code><</code> __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_p = __pyx_t_6;
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_8 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s__isnan);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_9 = __pyx_v_s;
      __pyx_t_10 = __pyx_v_p;
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_X.rcbuffer->pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_X.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_X.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_7);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_7 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_8, ((PyObject *)__pyx_t_11), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_11)); __pyx_t_11 = 0;
      __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_13 = ((!__pyx_t_12) != 0);
      if (__pyx_t_13) {
        __pyx_t_7 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_s + (__pyx_v_p * __pyx_v_S)));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_1, (PyObject*)__pyx_t_7)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        goto __pyx_L7;
      }
      __pyx_L7:;
    }
  }
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, ((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_1));
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_7), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_14 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_pairs.rcbuffer->pybuffer);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_pairs.rcbuffer->pybuffer, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_3 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_15, &__pyx_t_16, &__pyx_t_17);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_pybuffernd_pairs.rcbuffer->pybuffer, (PyObject*)__pyx_v_pairs, &__Pyx_TypeInfo_long, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_15); Py_XDECREF(__pyx_t_16); Py_XDECREF(__pyx_t_17);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_15, __pyx_t_16, __pyx_t_17);
      }
    }
    __pyx_pybuffernd_pairs.diminfo[0].strides = __pyx_pybuffernd_pairs.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_pairs.diminfo[0].shape = __pyx_pybuffernd_pairs.rcbuffer->pybuffer.shape[0];
    if (unlikely(__pyx_t_3 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_14 = 0;
  __pyx_v_pairs = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36:     for epoch in range(n_iters):</pre>
<pre id='line36' class='code' style='background-color: #FFFFff'>
  /* "edami/sgd.pyx":36
 * 
 *     pairs = np.array([s + p*S for s in range(S) for p in range(P) if not np.isnan(X[s, p])])
 *     for epoch in range(n_iters):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         np.random.shuffle(pairs)
 *         for ele in pairs:
 */
  __pyx_t_18 = __pyx_v_n_iters;
  for (__pyx_t_19 = 0; __pyx_t_19 <code><</code> __pyx_t_18; __pyx_t_19+=1) {
    __pyx_v_epoch = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line37")'> 37:         np.random.shuffle(pairs)</pre>
<pre id='line37' class='code' style='background-color: #FFFF41'>
    /* "edami/sgd.pyx":37
 *     pairs = np.array([s + p*S for s in range(S) for p in range(P) if not np.isnan(X[s, p])])
 *     for epoch in range(n_iters):
 *         np.random.shuffle(pairs)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for ele in pairs:
 *             s = ele % S
 */
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    __pyx_t_7 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__random);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s__shuffle);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_pairs));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, ((PyObject *)__pyx_v_pairs));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_pairs));
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_7), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line38")'> 38:         for ele in pairs:</pre>
<pre id='line38' class='code' style='background-color: #FFFF24'>
    /* "edami/sgd.pyx":38
 *     for epoch in range(n_iters):
 *         np.random.shuffle(pairs)
 *         for ele in pairs:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             s = ele % S
 *             p = ele / S
 */
    if (<span class='py_c_api'>PyList_CheckExact</span>(((PyObject *)__pyx_v_pairs)) || <span class='py_c_api'>PyTuple_CheckExact</span>(((PyObject *)__pyx_v_pairs))) {
      __pyx_t_2 = ((PyObject *)__pyx_v_pairs); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_20 = 0;
      __pyx_t_21 = NULL;
    } else {
      __pyx_t_20 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(((PyObject *)__pyx_v_pairs));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_21 = Py_TYPE(__pyx_t_2)->tp_iternext;
    }
    for (;;) {
      if (!__pyx_t_21 && <span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_20 >= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_2, __pyx_t_20); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_20++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_20); __pyx_t_20++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else if (!__pyx_t_21 && <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2)) {
        if (__pyx_t_20 >= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_2)) break;
        #if CYTHON_COMPILING_IN_CPYTHON
        __pyx_t_7 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_20); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_20++;<span class='error_goto'> if (unlikely(0 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #else
        __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_20); __pyx_t_20++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        #endif
      } else {
        __pyx_t_7 = __pyx_t_21(__pyx_t_2);
        if (unlikely(!__pyx_t_7)) {
          if (<span class='py_c_api'>PyErr_Occurred</span>()) {
            if (likely(<span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
            else<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          }
          break;
        }
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      }
      __pyx_t_3 = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_3 == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_ele = __pyx_t_3;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39:             s = ele % S</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'>
      /* "edami/sgd.pyx":39
 *         np.random.shuffle(pairs)
 *         for ele in pairs:
 *             s = ele % S             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             p = ele / S
 *             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])
 */
      __pyx_v_s = (__pyx_v_ele % __pyx_v_S);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40:             p = ele / S</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'>
      /* "edami/sgd.pyx":40
 *         for ele in pairs:
 *             s = ele % S
 *             p = ele / S             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])
 *             error = X[s, p] - prediction
 */
      __pyx_v_p = (__pyx_v_ele / __pyx_v_S);
</pre><pre class='line' style='background-color: #FFFF1f' onclick='toggleDiv("line41")'> 41:             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])</pre>
<pre id='line41' class='code' style='background-color: #FFFF1f'>
      /* "edami/sgd.pyx":41
 *             s = ele % S
 *             p = ele / S
 *             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             error = X[s, p] - prediction
 *             k = -alpha * error
 */
      __pyx_t_3 = __pyx_v_p;
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrCContig1d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_3, __pyx_pybuffernd_b.diminfo[0].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_11 = __Pyx_<span class='py_c_api'>PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s__dot);<span class='error_goto'> if (unlikely(!__pyx_t_11)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_skills), __pyx_v_s, sizeof(int), PyInt_FromLong, 0, 0, 0);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
      __pyx_t_8 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_p);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_k_slice_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_k_slice_1);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_k_slice_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1, __pyx_t_8);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_8);
      __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_qmatrix), ((PyObject *)__pyx_t_22));<span class='error_goto'> if (!__pyx_t_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_22)); __pyx_t_22 = 0;
      __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_22);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_t_1);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1, __pyx_t_8);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_8);
      __pyx_t_1 = 0;
      __pyx_t_8 = 0;
      __pyx_t_8 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_11, ((PyObject *)__pyx_t_22), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_22)); __pyx_t_22 = 0;
      __pyx_t_22 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_7, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_23 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_22);<span class='error_goto'> if (unlikely((__pyx_t_23 == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
      __pyx_v_prediction = __pyx_t_23;

  /* "edami/sgd.pyx":41
 *             s = ele % S
 *             p = ele / S
 *             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             error = X[s, p] - prediction
 *             k = -alpha * error
 */
  __pyx_k_slice_1 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_k_slice_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_k_slice_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_k_slice_1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:             error = X[s, p] - prediction</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'>
      /* "edami/sgd.pyx":42
 *             p = ele / S
 *             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])
 *             error = X[s, p] - prediction             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             k = -alpha * error
 *             if learn_b == 1:
 */
      __pyx_t_4 = __pyx_v_s;
      __pyx_t_5 = __pyx_v_p;
      __pyx_v_error = ((*__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_X.rcbuffer->pybuffer.buf, __pyx_t_4, __pyx_pybuffernd_X.diminfo[0].strides, __pyx_t_5, __pyx_pybuffernd_X.diminfo[1].strides)) - __pyx_v_prediction);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43:             k = -alpha * error</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'>
      /* "edami/sgd.pyx":43
 *             prediction = b[p] + np.dot(skills[s], qmatrix[:, p])
 *             error = X[s, p] - prediction
 *             k = -alpha * error             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if learn_b == 1:
 *                 b[p] += -k
 */
      __pyx_v_k = ((-__pyx_v_alpha) * __pyx_v_error);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:             if learn_b == 1:</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'>
      /* "edami/sgd.pyx":44
 *             error = X[s, p] - prediction
 *             k = -alpha * error
 *             if learn_b == 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 b[p] += -k
 *             for c in range(concepts):
 */
      __pyx_t_13 = ((__pyx_v_learn_b == 1) != 0);
      if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45:                 b[p] += -k</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'>
        /* "edami/sgd.pyx":45
 *             k = -alpha * error
 *             if learn_b == 1:
 *                 b[p] += -k             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for c in range(concepts):
 *                 oldskill = skills[s, c]
 */
        __pyx_t_6 = __pyx_v_p;
        *__Pyx_BufPtrCContig1d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_b.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_b.diminfo[0].strides) += (-__pyx_v_k);
        goto __pyx_L12;
      }
      __pyx_L12:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:             for c in range(concepts):</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'>
      /* "edami/sgd.pyx":46
 *             if learn_b == 1:
 *                 b[p] += -k
 *             for c in range(concepts):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 oldskill = skills[s, c]
 *                 skills[s, c] += k * (-qmatrix[c, p])
 */
      __pyx_t_24 = __pyx_v_concepts;
      for (__pyx_t_25 = 0; __pyx_t_25 <code><</code> __pyx_t_24; __pyx_t_25+=1) {
        __pyx_v_c = __pyx_t_25;
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line47")'> 47:                 oldskill = skills[s, c]</pre>
<pre id='line47' class='code' style='background-color: #FFFF9f'>
        /* "edami/sgd.pyx":47
 *                 b[p] += -k
 *             for c in range(concepts):
 *                 oldskill = skills[s, c]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 skills[s, c] += k * (-qmatrix[c, p])
 *                 qmatrix[c, p] += k * (-oldskill)
 */
        __pyx_t_26 = __pyx_v_s;
        __pyx_t_27 = __pyx_v_c;
        __pyx_t_22 = <span class='py_c_api'>PyFloat_FromDouble</span>((*__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_skills.rcbuffer->pybuffer.buf, __pyx_t_26, __pyx_pybuffernd_skills.diminfo[0].strides, __pyx_t_27, __pyx_pybuffernd_skills.diminfo[1].strides)));<span class='error_goto'> if (unlikely(!__pyx_t_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_22);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_oldskill);
        __pyx_v_oldskill = __pyx_t_22;
        __pyx_t_22 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:                 skills[s, c] += k * (-qmatrix[c, p])</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'>
        /* "edami/sgd.pyx":48
 *             for c in range(concepts):
 *                 oldskill = skills[s, c]
 *                 skills[s, c] += k * (-qmatrix[c, p])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 qmatrix[c, p] += k * (-oldskill)
 *                 if qmatrix[c, p] <code><</code> 0:
 */
        __pyx_t_28 = __pyx_v_c;
        __pyx_t_29 = __pyx_v_p;
        __pyx_t_30 = __pyx_v_s;
        __pyx_t_31 = __pyx_v_c;
        *__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_skills.rcbuffer->pybuffer.buf, __pyx_t_30, __pyx_pybuffernd_skills.diminfo[0].strides, __pyx_t_31, __pyx_pybuffernd_skills.diminfo[1].strides) += (__pyx_v_k * (-(*__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.buf, __pyx_t_28, __pyx_pybuffernd_qmatrix.diminfo[0].strides, __pyx_t_29, __pyx_pybuffernd_qmatrix.diminfo[1].strides))));
</pre><pre class='line' style='background-color: #FFFF43' onclick='toggleDiv("line49")'> 49:                 qmatrix[c, p] += k * (-oldskill)</pre>
<pre id='line49' class='code' style='background-color: #FFFF43'>
        /* "edami/sgd.pyx":49
 *                 oldskill = skills[s, c]
 *                 skills[s, c] += k * (-qmatrix[c, p])
 *                 qmatrix[c, p] += k * (-oldskill)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if qmatrix[c, p] <code><</code> 0:
 *                     qmatrix[c, p] = 0
 */
        __pyx_t_22 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_k);<span class='error_goto'> if (unlikely(!__pyx_t_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_22);
        __pyx_t_8 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_v_oldskill);<span class='error_goto'> if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_8);
        __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_22, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_32 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_7);<span class='error_goto'> if (unlikely((__pyx_t_32 == (npy_float64)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_33 = __pyx_v_c;
        __pyx_t_34 = __pyx_v_p;
        *__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.buf, __pyx_t_33, __pyx_pybuffernd_qmatrix.diminfo[0].strides, __pyx_t_34, __pyx_pybuffernd_qmatrix.diminfo[1].strides) += __pyx_t_32;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:                 if qmatrix[c, p] &lt; 0:</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'>
        /* "edami/sgd.pyx":50
 *                 skills[s, c] += k * (-qmatrix[c, p])
 *                 qmatrix[c, p] += k * (-oldskill)
 *                 if qmatrix[c, p] <code><</code> 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     qmatrix[c, p] = 0
 *                 if qmatrix[c, p] > 1:
 */
        __pyx_t_35 = __pyx_v_c;
        __pyx_t_36 = __pyx_v_p;
        __pyx_t_13 = (((*__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.buf, __pyx_t_35, __pyx_pybuffernd_qmatrix.diminfo[0].strides, __pyx_t_36, __pyx_pybuffernd_qmatrix.diminfo[1].strides)) <code><</code> 0.0) != 0);
        if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:                     qmatrix[c, p] = 0</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'>
          /* "edami/sgd.pyx":51
 *                 qmatrix[c, p] += k * (-oldskill)
 *                 if qmatrix[c, p] <code><</code> 0:
 *                     qmatrix[c, p] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 if qmatrix[c, p] > 1:
 *                     qmatrix[c, p] = 1
 */
          __pyx_t_37 = __pyx_v_c;
          __pyx_t_38 = __pyx_v_p;
          *__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.buf, __pyx_t_37, __pyx_pybuffernd_qmatrix.diminfo[0].strides, __pyx_t_38, __pyx_pybuffernd_qmatrix.diminfo[1].strides) = 0.0;
          goto __pyx_L15;
        }
        __pyx_L15:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:                 if qmatrix[c, p] &gt; 1:</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'>
        /* "edami/sgd.pyx":52
 *                 if qmatrix[c, p] <code><</code> 0:
 *                     qmatrix[c, p] = 0
 *                 if qmatrix[c, p] > 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     qmatrix[c, p] = 1
 *     return qmatrix, skills, b
 */
        __pyx_t_39 = __pyx_v_c;
        __pyx_t_40 = __pyx_v_p;
        __pyx_t_13 = (((*__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.buf, __pyx_t_39, __pyx_pybuffernd_qmatrix.diminfo[0].strides, __pyx_t_40, __pyx_pybuffernd_qmatrix.diminfo[1].strides)) > 1.0) != 0);
        if (__pyx_t_13) {
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line53")'> 53:                     qmatrix[c, p] = 1</pre>
<pre id='line53' class='code' style='background-color: #FFFFe7'>
          /* "edami/sgd.pyx":53
 *                     qmatrix[c, p] = 0
 *                 if qmatrix[c, p] > 1:
 *                     qmatrix[c, p] = 1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return qmatrix, skills, b
 */
          __pyx_t_41 = __pyx_v_c;
          __pyx_t_42 = __pyx_v_p;
          *__Pyx_BufPtrCContig2d(__pyx_t_5edami_3sgd_DOUBLE *, __pyx_pybuffernd_qmatrix.rcbuffer->pybuffer.buf, __pyx_t_41, __pyx_pybuffernd_qmatrix.diminfo[0].strides, __pyx_t_42, __pyx_pybuffernd_qmatrix.diminfo[1].strides) = 1.0;
          goto __pyx_L16;
        }
        __pyx_L16:;
      }
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
</pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line54")'> 54:     return qmatrix, skills, b</pre>
<pre id='line54' class='code' style='background-color: #FFFF2b'>
  /* "edami/sgd.pyx":54
 *                 if qmatrix[c, p] > 1:
 *                     qmatrix[c, p] = 1
 *     return qmatrix, skills, b             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_qmatrix));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_v_qmatrix));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_qmatrix));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_skills));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_skills));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_skills));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_b));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, ((PyObject *)__pyx_v_b));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_b));
  __pyx_r = ((PyObject *)__pyx_t_2);
  __pyx_t_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_X.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_pairs.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_qmatrix.rcbuffer->pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_skills.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("edami.sgd.sgd", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_X.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_b.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_pairs.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_qmatrix.rcbuffer->pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_pybuffernd_skills.rcbuffer->pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_pairs);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_oldskill);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

/* Python wrapper */
static CYTHON_UNUSED int __pyx_pw_5numpy_7ndarray_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
static CYTHON_UNUSED int __pyx_pw_5numpy_7ndarray_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("__getbuffer__ (wrapper)", 0);
  __pyx_r = __pyx_pf_5numpy_7ndarray___getbuffer__(((PyArrayObject *)__pyx_v_self), ((Py_buffer *)__pyx_v_info), ((int)__pyx_v_flags));
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre></body></html>
